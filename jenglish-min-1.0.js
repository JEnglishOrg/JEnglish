/*
Copyright © 2014 Arnouse Digital Device Corp. 
Licensed under the Creative Commons Attribution-NonCommercial 4.0 International Public License (“Public License”); you may not use this file except in compliance with the Public License. You may obtain a copy of the Public License at
http://creativecommons.org/licenses/by-nc/4.0/legalcode
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
*/
function log(e){try{if(debug===true){console.log("JEnglish: "+e)}}catch(t){}}function warn(e){try{if(warnings===true){console.log("JEnglish Warning: "+e)}}catch(t){}}function applyImageClickHandlers(){var e;for(var t=0;t<imageClickHandlers.length;++t){e=imageClickHandlers[t];$_(e.id).onclick=e.func}}function create_elem(e){return document.createElement(e)}function create_elem_id(e,t){t=t.trim().toLowerCase();if(!isValidId(t)){log("Invalid ID: "+t+". IDs must start with a letter, and can only contains upper and lower-case letters, digits, underscore, colon, or a period");return null}var n=document.createElement(e);if(n===undefined||n==null){log("Unknown Element named: "+e);return null}n.id=t;return n}function $_(e){return document.getElementById(e)}function isValidId(e){return/^[A-Za-z][-A-Za-z0-9_:.]*$/.test(e)}function cmd(e){if(e==null||e===undefined){log("ERROR: Cmd - No command given");return}if(e.length==0){return}if(e.indexOf("...")!=-1){e=e.replace("...","~~~")}if(e.indexOf(".. ")!=-1){var t=e.split(".. ");for(var n=0;n<t.length;++n){if(t[n].length>0){if(t[n].substring(t[n].length-2)==".."){t[n]=t[n].substring(0,t[n].length-2)}t[n]=t[n].replace("~~~","...");i(t[n])}}}else{if(e.substring(e.length-2)==".."){e=e.substring(0,e.length-2)}e=e.replace("~~~","...");i(e)}}function i(cmd){try{var cmdArr=cmd.split(" ");cmdArr[0]=cmdArr[0].toLowerCase().trim();if(cmdArr==null||cmdArr===undefined||cmdArr.length<=0){log("ERROR: Cmd - Unable to split up the command");return}var paramCt=c[cmdArr[0]+"_params"];if(paramCt==null||paramCt===undefined){log("ERROR: Cmd - No parameter count given for command = "+cmdArr[0]);return}var paramOrder=c[cmdArr[0]+"_order"];if(paramOrder==null||paramOrder===undefined){log("ERROR: Cmd - No parameter order given for command");return}var cmdParamIdx=paramOrder.split(",");if(cmdParamIdx==null||cmdParamIdx===undefined){log("ERROR: Cmd - Unable to split parameter indexes for command");return}if(paramCt>cmdParamIdx.length){log("ERROR: Cmd - Parameter count is greater than the number of parameter indexes you passed in");return}var lastParam=cmdParamIdx[paramCt-1];if(lastParam==null||lastParam==undefined){log("ERROR: Cmd - Unable to parse the final/last parameter index");return}if(lastParam.endsWith("*")){lastParam=lastParam.substring(0,lastParam.length-1)}if(cmdArr.length>lastParam){var tmp=cmdArr;var finalParam=tmp.slice(lastParam,cmdArr.length);tmp.splice(lastParam,cmdArr.length-lastParam);var str="";for(var yy=0;yy<finalParam.length;++yy){str+=finalParam[yy]+" "}str=str.substring(0,str.length-1);tmp.push(str);cmdArr=tmp}var func="c[ '"+cmdArr[0]+"' ]( ";var params="";for(var ii=0;ii<paramCt;++ii){var paramIdx=cmdParamIdx[ii];if(paramIdx.endsWith("+")||paramIdx.endsWith("*")){paramIdx=paramIdx.substring(0,paramIdx.length-1)}params+="cmdArr[ "+paramIdx+" ]";if(paramCt>1&&ii<paramCt-1){params+=", "}}func+=params+" );";eval(func);if(c[cmdArr[0]+"_exts"]==undefined||c[cmdArr[0]+"_exts"]==""){return}else if(!(c[cmdArr[0]+"_exts"]instanceof Array)){log("I: Extension of an Object should define an Array, even if there is only 1 variable");return}if(c[cmdArr[0]+"_exts"]instanceof Array){if(c[cmdArr[0]+"_exts"].length>0){for(var ii=0;ii<c[cmdArr[0]+"_exts"].length;++ii){func='c["'+cmdArr[0]+'_exts"]['+ii+"]("+params+");";try{eval(func)}catch(e){log("I: ERROR: Cannot run Extension for command = |"+cmdArr[0]+"| : "+e)}}}}}catch(e){log("ERROR: Cmd - interpreting: |"+cmd+"| for reason = "+e)}}var debug=true;var warnings=true;var imageCount=0;var imageClickHandlers=[];var c={create_params:"3",create_order:"2,4,5*",create_exts:[],create:function(e,t,n){function g(e){var t=create_elem("style");if(t==null||t===undefined){return null}t.type="text/css";t.id=e;t.innerHTML="."+e+"{}";return t}function y(e){var t=create_elem_id("div",e);t.style.position="fixed";t.style.top="0px";t.style.left="0px";t.style.width="100%";t.style.height="100%";t.style.backgroundColor="rgba(0,0,0, 0.95)";var n=create_elem("img",e+"_close");n.style.position="absolute";n.style.top="25px";n.style.left="100%";n.style.marginLeft="-75px";n.style.cursor="pointer";n.onclick=function(){this.style.display="none";try{fade(this.parentNode.id,100,0,2)}catch(e){this.parentNode.style.display="none"}};n.src="http://jenglish.org/images/close_button.png";n.style.width="50px";n.style.height="50px";t.appendChild(n);return t}function b(e){var t=create_elem_id("span",e);if(t===undefined||t==null){log("Cannot create horizontal rule");return null}t.style.position="absolute";t.style.top="0px";t.style.width="100%";t.style.height="3px";t.style.backgroundColor="black";return t}function w(e){var t=create_elem_id("span",e);if(t===undefined||t==null){log("Cannot create vertical rule");return null}t.style.position="absolute";t.style.top="0px";t.style.height="100%";t.style.width="3px";t.style.backgroundColor="black";return t}function E(e,t,n){var r=create_elem_id(e,t);if(r===undefined||r==null){log("Error creating element with id, "+e+" with id = "+t+" is null");return null}r.style.position="absolute";r.style.top="0px";var i=n.split("~");if(i.length==0){log("Parsing UL titles, count = 0");return}for(var s=0;s<i.length;++s){if(i[s].trim()===""){continue}var o=create_elem("li");if(o===undefined||o==null){log("Error creating element, li is null");return null}o.innerHTML=i[s].trim();r.appendChild(o)}return r}t=t.toLowerCase();var r=$_(t);var i="body";if(n!==undefined&&n!==null){var s=n.trim().split(" ");if(s.length<=0){log("ERROR: Create - Unknown box to insert box |"+e+"| into");return}i=s[s.length-1].toLowerCase()}switch(e.toLowerCase()){case"blur":var o=y(t);if(o===undefined||o==null){return false}if(i==="body"){document.body.appendChild(o)}else{$_(i).appendChild(o)}break;case"box":case"div":var u=create_elem_id("div",t);if(u===undefined||u==null){return false}if(i==="body"){document.body.appendChild(u)}else{$_(i).appendChild(u)}break;case"class":case"style":var a=g(t);if(a===undefined||a==null){return false}document.getElementsByTagName("head")[0].appendChild(a);break;case"hr":case"hrule":case"horzrule":case"horizontalrule":case"horizontal":var f=b(t);if(f===undefined||f==null){return false}if(i==="body"){document.body.appendChild(f)}else{$_(i).appendChild(f)}break;case"link":case"hyperlink":case"a":var l=create_elem_id("a",t);if(l===undefined||l==null){return false}if(i==="body"){document.body.appendChild(l)}else{$_(i).appendChild(l)}break;case"img":case"image":var c=create_elem_id("img",t);if(c===undefined||c==null){return false}imageCount++;c.onload=function(){imageCount--;if(imageCount==0){applyImageClickHandlers()}};if(i==="body"){document.body.appendChild(c)}else{$_(i).appendChild(c)}break;case"ol":case"orderedlist":case"orderlist":case"numberlist":var h=E("ol",t,n);if(h===undefined||h==null){return false}if(i==="body"){document.body.appendChild(h)}else{$_(i).appendChild(h)}break;case"span":var a=create_elem_id("span",t);if(a===undefined||a==null){return false}if(i==="body"){document.body.appendChild(a)}else{$_(i).appendChild(a)}break;case"ul":case"unorderedlist":case"unorderlist":case"bulletlist":var p=E("ul",t,n);if(p===undefined||p==null){return false}if(i==="body"){document.body.appendChild(p)}else{$_(i).appendChild(p)}break;case"template":var o=create_elem_id("template",t);if(i==="body"){document.body.appendChild(o)}else{$_(i).appendChild(o)}break;case"textarea":var d=create_elem("textarea");d.id=t;if(i==="body"){document.body.appendChild(d)}else{$_(i).appendChild(d)}break;case"vr":case"vrule":case"vertrule":case"verticalrule":case"vertical":var v=w(t);if(v===undefined||v==null){return false}if(i==="body"){document.body.appendChild(v)}else{$_(i).appendChild(v)}break;default:try{var v=create_elem_id(e.toLowerCase(),t);if(v===undefined||v==null){return false}if(i==="body"){document.body.appendChild(v)}else{$_(i).appendChild(v)}}catch(m){return false}}},make_params:"2",make_order:"1,2*",make_exts:[],make:function(e,t){function l(e,t,n){t=t.toLowerCase();if(e.tagName.toLowerCase()=="style"){if(t.indexOf(":")!=-1){var r=e.innerHTML;r+=" ."+e.id+t+"{"+n+"}";e.innerHTML=r}else{var r=e.innerHTML;var r=r.substring(0,r.length-1);r+=t+":"+n+";}";e.innerHTML=r}}else{if(t=="classname"){e.className=n}else{if(e[t]===undefined||e[t]==null){var i=t+":"+n;e.style.cssText=e.style.cssText+";"+i}else{e[t]=n}}}}e=e.toLowerCase();if(e.indexOf("'s")!=-1||e.indexOf("'S")!=-1){e=e.substring(0,e.length-2)}var n=$_(e);if(e=="body"){n=document.body}if(n===undefined||n==null){log("Object named |"+e+"| was NOT found!");return false}if(t.indexOf(" and ")!=-1){var r=t.split(" and ");for(var i=0;i<r.length;++i){var s=r[i].trim().split(" ");if(s.length<2){log("ERROR: Make - not enough parameters, need at least 1 css property and 1 css value");return false}else if(s.length==2){l(n,s[0],s[1])}else{var o="";for(var u=1;u<s.length;++u){o+=s[u]+" "}o=o.trim();l(n,s[0],o)}}}else{var s=t.trim().split(" ");if(s.length<2){log("ERROR: Make - not enough parameters, need at least 1 css property and 1 css value");return false}else if(s.length>2){var a="";for(var f=1;f<s.length;++f){a+=s[f]+" "}a=a.trim();l(n,s[0],a)}else{l(n,s[0],s[1])}}},insert_params:"1",insert_order:"1*",insert_exts:[],insert:function(e){var t=e.trim().split(" ");if(t.length<=0){log("ERROR: Insert - Nothing to insert");return false}var n=t[t.length-1].toLowerCase();var r=$_(n);if(r===undefined||r===null){log("ERROR: Insert - Box |"+n+"| to insert into Does NOT Exist. Please create the box first.");return false}var i="";for(var s=0;s<t.length-2;++s){i+=t[s]+" "}i=i.trim();r.innerHTML=i},append_params:"1",append_order:"1*",append_exts:[],append:function(e){var t=e.split(" ");if(t.length<=0){log("ERROR: Append - Nothing to append");return false}var n=t[t.length-1].toLowerCase();var r=$_(n);if(r===undefined||r===null){log("ERROR: Append - Box to append to Does NOT Exist. Please create the box first.");return false}var i="";for(var s=0;s<t.length-2;++s){i+=t[s]+" "}i=i.substring(0,i.length-1);r.innerHTML+=i},move_params:"2",move_order:"1,2*",move_exts:[],move:function(e,t){function m(e,t,n){var r=$_(e);if(r===undefined||r==null){log("ERROR: Move - Could not find the box named |"+e+"|");return}var i=r.offsetTop;var s=r.offsetLeft;if(t.indexOf("%")!=-1){t=r.parentNode.offsetWidth*(parseInt(t)/100)}if(n.indexOf("%")!=-1){n=r.parentNode.offsetHeight*(parseInt(n)/100)}i=i+parseInt(n);s=s+parseInt(t);r.style.top=i+"px";r.style.left=s+"px"}function g(e){var t=$_(e).style;var n=t.top;if(t.top.indexOf("%")!=-1){n=$_(e).offsetTop}else if(objectStyle.top.indexOf("px")!=-1){n=t.top.replace("px","")}var r=t.left;if(t.left.indexOf("%")!=-1){r=$_(e).offsetLeft}else if(objectStyle.left.indexOf("px")!=-1){r=t.left.replace("px","")}return[n,r]}function y(e){if(parseInt(e)==="NaN"){return false}return true}e=e.toLowerCase();var n=$_(e);if(n===undefined||n==null){log("ERROR: Move - A Box named |"+e+"| does not exist.  Please create this element before moving it.");return false}else if(n.tagName.toLowerCase()=="style"){log("ERROR: Move - You cannot move a style element. Only boxes can be moved");return false}var r=t.split(" ");var i=-1;var s=-1;var o=-1;var u=-1;for(var a=0;a<r.length;++a){var f=r[a].toLowerCase();if(f=="left"){i=a}else if(f=="right"){s=a}else if(f=="up"){o=a}else if(f=="down"){u=a}}if(s!=-1&&i!=-1){log("ERROR: Move - You can only specify LEFT or RIGHT, but NOT both");return false}if(o!=-1&&u!=-1){log("ERROR: Move - You can only specify UP or DOWN, but NOT both");return false}if(o==-1&&u==-1&&i==-1&&s==-1){log("ERROR: Move - You MUST specify at least one of the following: left, right, up, down");return false}var l=-1;var c=-1;var h=-1;var p=-1;if(i!=-1){if(i+1>=r.length){log("ERROR: Move - No LEFT distance specified");return false}else{l=r[i+1];if(!y(l)){log("ERROR: Move - LEFT Distance is invalid");return false}}}else if(s!=-1){if(s+1>=r.length){log("ERROR: Move - No RIGHT distance specified");return false}else{c=r[s+1];if(!y(c)){log("ERROR: Move - RIGHT Distance is invalid");return false}}}if(o!=-1){if(o+1>=r.length){log("ERROR: Move - No UP distance specified");return false}else{h=r[o+1];if(!y(h)){log("ERROR: Move - UP Distance is invalid");return false}}}else if(u!=-1){if(u+1>=r.length){log("ERROR: Move - No DOWN distance specified");return false}else{p=r[u+1];if(!y(p)){log("ERROR: Move - DOWN Distance is invalid");return false}}}var d="-1";var v="-1";if(l!=-1){l="-"+l;d=l}else if(c!=-1){d=c}if(h!=-1){h="-"+h;v=h}else if(p!=-1){v=p}m(e,d,v)},when_params:"2",when_order:"1,2*",when_exts:[],when:function(e,t){try{e=e.toLowerCase();if(e.indexOf("'s")!=-1){e=e.substring(0,e.length-2)}var n=$_(e)}catch(r){log("ERROR: When - The Box |"+e+"| was not found. Please create the box first.");return false}var i=t.split(" ");if(i.length<4){log("ERROR: When - Command not long enough.  Please specify a sub-command(clicked/hovered) and action(web site/style)");return false}var s=i[1].toLowerCase();var o=i[2].toLowerCase();var u="";for(var a=3;a<i.length;++a){u+=i[a]+" "}u=u.trim();switch(s){case"clicked":switch(o){case"open":n.style.cursor="pointer";if(n.tagName.toUpperCase()=="IMG"){if(imageCount==0){n.onclick=function(){window.open(u)}}else{imageClickHandlers.push({id:n.id,func:function(){window.open(u)}})}}else{n.onclick=function(){window.open(u)}}break;case"goto":n.style.cursor="pointer";if(n.tagName.toUpperCase()=="IMG"){if(imageCount==0){n.onclick=function(){window.location.assign(u)}}else{imageClickHandlers.push({id:n.id,func:function(){window.location.assign(u)}})}}else{n.onclick=function(){window.location.assign(u)}}break;case"show":n.style.cursor="pointer";if(u=="fullscreen"){var f=$_("fullscreenBlur");if(f==undefined||f==null){var f=create_elem_id("div","fullscreenBlur");f.style.position="fixed";f.style.width="100%";f.style.height="100%";f.style.background="rgba(0,0,0,0.95)";f.style.zIndex="100000";f.style.visibility="hidden";var l=create_elem_id("img","close_fullscreenBlur");l.src="http://jenglish.org/assets/imgs/close_button.png";l.style.position="absolute";l.style.top="20px";l.style.left="calc(100% - 70px)";l.style.zIndex="100001";l.style.cursor="pointer";l.onclick=function(){$_("fullscreenimg").style.backgroundImage="";$_("fullscreenblur").style.visibility="hidden"};f.appendChild(l);var h=create_elem_id("div","fullscreenImg");h.style.height="100%";h.style.width="100%";h.style.backgroundSize="contain";h.style.backgroundRepeat="no-repeat";h.style.backgroundPosition="center";f.appendChild(h);document.body.appendChild(f)}n.onclick=function(){$_("fullscreenimg").style.backgroundImage="url('"+this.src+"')";$_("fullscreenblur").style.visibility="visible"}}else{n.onclick=function(){$_(u).style.display="block"}}break;case"hide":n.style.cursor="pointer";n.onclick=function(){$_(u).style.display="none"};break;default:log("ERROR: When - Unknown sub command action = |"+o+"|");return false}break;case"hovered":switch(o){case"make":if(u.indexOf(" otherwise ")==-1){n.onmouseover=function(){c["make"](e,u)}}else{var p=u.split(" otherwise ");if(p.length!=2){log("ERROR: When - Please include both a hovered and otherwise (non-hovered) action");return false}var d=p[0];var v=p[1];if(v.indexOf("make ")!=-1){v=v.substring(5)}n.onmouseover=function(){c["make"](e,d)};n.onmouseout=function(){c["make"](e,v)}}break;default:log("ERROR: When - Unknown sub command action = |"+o+"|");return false}break;default:log("ERROR: When - Unkown sub command action = |"+s+"|");return false}}};String.prototype.endsWith=function(e){return this.indexOf(e,this.length-e.length)!==-1}